{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="60">
    <meta name="description" content="">
    <title>HomePage</title>
    <link rel="icon" href="{% static 'images/Иконка.png' %}" type="image/png">
    <link rel="stylesheet" href="{% static 'css/nicepage.css' %}" media="screen">
    <link rel="stylesheet" href="{% static 'css/HomePage.css' %}" media="screen">
    <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
    
    <script class="u-script" type="text/javascript" src="{% static 'js/jquery.js' %}" defer=""></script>
    <script class="u-script" type="text/javascript" src="{% static 'js/nicepage.js' %}" defer=""></script>
    <meta name="generator" content="Nicepage 5.21.10, nicepage.com">
    
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "NotaSchool_register"
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="HomePage">
    <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/"></head>
  <body data-path-to-root="./" data-include-products="true" class="u-body u-xl-mode" data-lang="ru">
    <section class="u-clearfix u-gradient u-section-1" id="sec-90ad">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h4 class="u-text u-text-body-alt-color u-text-default u-text-1"> Игра «Кто хочет стать миллионером?»</h4>
        <p class="u-text u-text-body-alt-color u-text-2"> &nbsp; &nbsp; Добро пожаловать в бесплатную онлайн-версию знаменитого игрового шоу «Кто хочет стать миллионером?». В этой уникальной игре можно ощутить себя настоящим участником телепрограммы, завоевавшей миллионы поклонников по всему миру. Бесплатная версия игры позволит в режиме реального времени стать главным героем нашумевшей передачи.<br>
          <br>&nbsp; &nbsp; &nbsp;Игра доступна для каждого, кто хочет проверить себя в серии тестов, состоящих из интересных вопросов и неожиданных ответов. Испытайте свою интеллект просто используя свои знания и весело проводя время.Игра состоит из 15 вопросов.&nbsp;<br>
          <br>&nbsp; &nbsp; &nbsp;Уровень сложности и шансы получить деньги увеличиваются с каждым новым вопросом. Например, при ответе на первый блок вопросов Ваш призовой фонд составит от 500 до 5000 рублей. Играйте, правильно отвечайте на вопросы в процессе игры – и призовой фонд будет увеличиваться на глазах, пока Вы не дойдете до финального вопроса, и если Вы ответите на него правильно, то станете счастливым обладателем трёх миллионов рублей!<br>
          <br>&nbsp; &nbsp; &nbsp;Ключом к успеху является Ваши интеллект, так что вперед за призом! Вооружившись самыми разнообразными знаниями, которые Вы приобрели за свою жизнь, Вы сможете легко и быстро заработать свои три миллиона рублей!
        </p>
        <p class="u-text u-text-body-alt-color u-text-default u-text-3" id="level15">3 000 000 ₽</p>
        <img class="u-image u-image-contain u-image-default u-image-1" src="{% static 'images/logo.webp' %}" alt="" data-image-width="504" data-image-height="435">
        <p class="u-text u-text-default u-text-palette-3-base u-text-4" id="level14">1 500 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-5" id="level13">800 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-6" id="level12">400 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-7" id="level11">200 000 ₽</p>
        <p class="u-text u-text-body-alt-color u-text-default u-text-8" id="level10">100 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-9" id="level9">50 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-10" id="level8">25 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-11" id="level7">15 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-12" id="level6">10 000 ₽</p>
        <p class="u-text u-text-body-alt-color u-text-default u-text-13" id="level5">5 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-14" id="level4">3 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-15" id="level3">2 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-16" id="level2">1 000 ₽</p>
        <p class="u-text u-text-default u-text-palette-3-base u-text-17" id="level1">500 ₽</p>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-3 u-radius-50 u-btn-1" id="fiftyFiftyButton" onclick="useFiftyFifty(); return false;">50/50</a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-3 u-radius-50 u-btn-2" onclick="showAudienceHint(); return false;"><span class="u-file-icon u-icon u-text-white u-icon-1"><img src="{% static 'images/Помощь-зала.png' %}" alt=""></span>&nbsp;
        </a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-3 u-radius-50 u-btn-3" id="friendHintButton" onclick="showFriendHint(); return false;"><span class="u-file-icon u-icon u-text-white u-icon-2"><img src="{% static 'images/Звонок-другу.png' %}" alt=""></span>&nbsp;
        </a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-3 u-radius-50 u-btn-4" id="secondChanceButton" onclick="activateSecondChance(); return false;"><span class="u-file-icon u-icon u-text-white u-icon-3"><img src="{% static 'images/Право-на-ошибку.png' %}" alt=""></span>
        </a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-3 u-radius-50 u-btn-5" onclick="replaceQuestion(); return false;"><span class="u-file-icon u-icon u-text-white u-icon-4"><img src="{% static 'images/Замена-вопроса.png' %}" alt=""></span>
        </a>
        <span class="u-file-icon u-icon u-text-palette-3-light-1 u-icon-5">
          <a href="#" onclick="toggleSound(); return false;">
            <img src="{% static 'images/Без-звука.png' %}" id="soundIcon" alt="">
          </a>
        </span>
        <audio id="backgroundMusic" loop>
          <source src="{% static 'audio/BackGround.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
      <audio id="timeUpSound">
          <source src="{% static 'audio/Время-истекло.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
      <audio id="gameOverSound">
          <source src="{% static 'audio/Конец-игры.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
      <audio id="wrongAnswerSound">
          <source src="{% static 'audio/Неправильный-ответ.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
      <audio id="hintSound">
          <source src="{% static 'audio/Подсказка.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
      <audio id="correctAnswerSound">
          <source src="{% static 'audio/Правильный-ответ.mp3' %}" type="audio/mpeg">
          Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
        <div class="u-border-2 u-border-grey-60 u-container-style u-grey-50 u-group u-opacity u-opacity-40 u-radius-22 u-shape-round u-group-1">
          <div class="u-container-layout u-container-layout-1">
            {% if question %}
            <h6 class="u-text u-text-body-alt-color u-text-default u-text-18" id="questionText"> {{ question.question }}</h6>
          </div>
        </div>
        <div id="questionContainer" data-right-answer="{{ question.right_answer }}">
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-2 u-radius-13 u-btn-6 answer-btn" data-answer="1" id="answerBtn1" data-question-id="{{ question.id }}">A: {{ question.answer1 }}</a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-2 u-radius-13 u-btn-7 answer-btn" data-answer="2" id="answerBtn2" data-question-id="{{ question.id }}">B: {{ question.answer2 }}</a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-2 u-radius-13 u-btn-8 answer-btn" data-answer="3" id="answerBtn3" data-question-id="{{ question.id }}">C: {{ question.answer3 }}</a>
        <a href="" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-3-dark-1 u-palette-1-dark-2 u-radius-13 u-btn-9 answer-btn" data-answer="4" id="answerBtn4" data-question-id="{{ question.id }}">D: {{ question.answer4 }}</a>
        {% endif %}
        </div>
        <div class="timer u-border-2 u-border-palette-4-light-1 u-container-style u-custom-color-5 u-group u-radius-17 u-shape-round u-group-2">
          <div class="u-container-layout u-valign-middle u-container-layout-2">
              <h2 class="u-text u-text-default u-text-white u-text-19" id="timerDisplay">60</h2>
          </div>
        </div>      
        <h3 class="u-text u-text-body-alt-color u-text-default u-text-20">Топ-10 победителей</h3>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-3">
            <div class="u-container-layout u-container-layout-3">
                <h4 class="u-text u-text-default u-text-21">1</h4>
                <h4 class="u-text u-text-default u-text-22">{% if winner1 %}{{ winner1.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-23">{% if winner1 %}{{ winner1.first_name }} {{ winner1.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-4">
            <div class="u-container-layout u-container-layout-4">
                <h4 class="u-text u-text-default u-text-24">2</h4>
                <h4 class="u-text u-text-default u-text-25">{% if winner2 %}{{ winner2.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-26">{% if winner2 %}{{ winner2.first_name }} {{ winner2.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-5">
            <div class="u-container-layout u-container-layout-5">
                <h4 class="u-text u-text-default u-text-27">3</h4>
                <h4 class="u-text u-text-default u-text-28">{% if winner3 %}{{ winner3.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-29">{% if winner3 %}{{ winner3.first_name }} {{ winner3.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-6">
            <div class="u-container-layout u-container-layout-6">
                <h4 class="u-text u-text-default u-text-30">4</h4>
                <h4 class="u-text u-text-default u-text-31">{% if winner4 %}{{ winner4.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-32">{% if winner4 %}{{ winner4.first_name }} {{ winner4.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-7">
            <div class="u-container-layout u-container-layout-7">
                <h4 class="u-text u-text-default u-text-33">5</h4>
                <h4 class="u-text u-text-default u-text-34">{% if winner5 %}{{ winner5.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-35">{% if winner5 %}{{ winner5.first_name }} {{ winner5.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-8">
            <div class="u-container-layout u-container-layout-8">
                <h4 class="u-text u-text-default u-text-36">6</h4>
                <h4 class="u-text u-text-default u-text-37">{% if winner6 %}{{ winner6.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-38">{% if winner6 %}{{ winner6.first_name }} {{ winner6.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-9">
            <div class="u-container-layout u-container-layout-9">
                <h4 class="u-text u-text-default u-text-39">7</h4>
                <h4 class="u-text u-text-default u-text-40">{% if winner7 %}{{ winner7.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-41">{% if winner7 %}{{ winner7.first_name }} {{ winner7.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-10">
            <div class="u-container-layout u-container-layout-10">
                <h4 class="u-text u-text-default u-text-42">8</h4>
                <h4 class="u-text u-text-default u-text-43">{% if winner8 %}{{ winner8.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-44">{% if winner8 %}{{ winner8.first_name }} {{ winner8.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-11">
            <div class="u-container-layout u-container-layout-11">
                <h4 class="u-text u-text-default u-text-45">9</h4>
                <h4 class="u-text u-text-default u-text-46">{% if winner9 %}{{ winner9.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-47">{% if winner9 %}{{ winner9.first_name }} {{ winner9.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
        <div class="u-container-style u-expanded-width u-grey-50 u-group u-radius-22 u-shape-round u-group-12">
            <div class="u-container-layout u-container-layout-12">
                <h4 class="u-text u-text-default u-text-48">10</h4>
                <h4 class="u-text u-text-default u-text-49">{% if winner10 %}{{ winner10.prize_amount|intcomma }} ₽{% else %}—{% endif %}</h4>
                <h4 class="u-text u-text-default u-text-50">{% if winner10 %}{{ winner10.first_name }} {{ winner10.last_name }}{% else %}—{% endif %}</h4>
            </div>
        </div>
      </div>
    </section>

    <div id="myModal" class="modal">
      <span class="close">&times;</span>
      <div class="modal-content">
        <h2>Регистрация</h2>
        <form action="/" method="post">
          {% csrf_token %}
          <input type="text" id="fname" name="first_name" placeholder="Введите имя...">
          <input type="text" id="lname" name="last_name" placeholder="Введите фамилию...">
          <div style="text-align: center;">
            <button type="submit">Начать игру!</button>
        </div>
        </form>
      </div>
    </div>

    <div id="friendHintModal" class="modal-friend">
      <div class="modal-friend-content">
        <span class="close-friend" id="closeFriendHintModal">&times;</span>
        <h2>Подсказка: Звонок другу</h2>
        <p id="friendHintText">Ваш друг считает, что правильный ответ {Правильный ответ}</p>
        <button id="friendHintOkButton">OK</button>
      </div>
    </div>

    <div id="audienceHintModal" class="modal-audience">
      <div class="modal-audience-content">
        <span class="close-audience" id="closeAudienceHintModal">&times;</span>
        <h2>Подсказка: Помощь зала</h2>
        <canvas id="audienceChart"></canvas>
        <button id="audienceHintOkButton">OK</button>
      </div>
    </div>
    
    <style>
      .u-group-2 {
          display: flex;
          justify-content: center; /* Горизонтальное выравнивание */
          align-items: center; /* Вертикальное выравнивание */
          height: 100%; /* Обеспечивает, что flex-контейнер занимает всю высоту родителя */
      }
      .highlight {
          background-color: yellow !important;
      }
      .current-level {
        border: 2px solid #FFD700; /* Золотая рамка */
        padding: 5px;
        border-radius: 5px;
      }
      .modal-friend {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
        padding-top: 60px;
      }
      
      .modal-friend-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
      }
      
      .close-friend {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      
      .close-friend:hover,
      .close-friend:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      .modal-audience {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
        padding-top: 60px;
      }
      
      .modal-audience-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
      }
      
      .close-audience {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      
      .close-audience:hover,
      .close-audience:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }      
      </style>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
      var modal = document.getElementById("myModal");
      var span = document.getElementsByClassName("close")[0];
  
      span.onclick = function() {
          modal.style.display = "none";
      };
  
      window.onload = function() {
          // Проверяем, есть ли в cookies флаг успешной регистрации
          var registrationSuccess = document.cookie.split('; ').find(row => row.startsWith('registration_success='));
          if (!registrationSuccess) {
              modal.style.display = "block";
          }
          updateLevelHighlight(1); // Выделение начального уровня
          {% if question %}
             updateQuestionAndAnswers(1); // Начальная загрузка первого вопроса
          {% endif %}
      };

      var timerInterval = null; // Глобальная переменная для интервала таймера

    // Функция для получения CSRF токена из cookies
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var isMuted = false; // Переменная для отслеживания состояния звука

function toggleSound() {
    isMuted = !isMuted; // Переключаем состояние звука
    var soundIcon = document.getElementById('soundIcon');
    var audioElements = document.querySelectorAll('audio');

    if (isMuted) {
        soundIcon.src = "{% static 'images/Без-звука.png' %}"; // Иконка "без звука"
        audioElements.forEach(audio => audio.volume = 0); // Отключаем звук
    } else {
        soundIcon.src = "{% static 'images/Со-звуком.png' %}"; // Иконка "со звуком"
        audioElements.forEach(audio => audio.volume = 1); // Включаем звук
    }
}

function playSound(soundId) {
    var sound = document.getElementById(soundId);
    if (sound && !isMuted) {
        sound.currentTime = 0; // Сбрасываем воспроизведение
        sound.play();
    }
}

// Функция для воспроизведения фоновой музыки при загрузке вопроса
function playBackgroundMusic() {
    var backgroundMusic = document.getElementById('backgroundMusic');
    if (!isMuted) {
        backgroundMusic.currentTime = 0; // Сбрасываем воспроизведение
        backgroundMusic.play();
    }
}

// Функция для воспроизведения звука при правильном ответе
function onCorrectAnswer() {
    playSound('correctAnswerSound');
}

// Функция для воспроизведения звука при неправильном ответе
function onWrongAnswer() {
    playSound('wrongAnswerSound');
}

// Функция для воспроизведения звука, когда время истекло
function onTimeUp() {
    playSound('timeUpSound');
}

// Функция для воспроизведения звука при окончании игры
function onGameOver() {
    playSound('gameOverSound');
}

// Функция для воспроизведения звука при использовании подсказки
function onHint() {
    playSound('hintSound');
}

    function showAudienceHint() {
      var correctAnswer = parseInt(document.getElementById('questionContainer').getAttribute('data-right-answer'));
      
      onHint();

      // Генерация голосов для каждого ответа
      var votes = [0, 0, 0, 0];
      votes[correctAnswer - 1] = Math.floor(Math.random() * 30) + 45; // Правильный ответ получает 45-75% голосов
      var remainingVotes = 100 - votes[correctAnswer - 1];
      
      for (var i = 0; i < 4; i++) {
          if (i !== correctAnswer - 1) {
              votes[i] = Math.floor(Math.random() * (remainingVotes - (3 - i) * 5)) + 5; // Остальные ответы получают оставшиеся голоса
              remainingVotes -= votes[i];
          }
      }
      
      // Отображение диаграммы
      var ctx = document.getElementById('audienceChart').getContext('2d');
      new Chart(ctx, {
          type: 'bar',
          data: {
              labels: ['A', 'B', 'C', 'D'],
              datasets: [{
                  label: 'Голоса зала',
                  data: votes,
                  backgroundColor: ['#4CAF50', '#FFEB3B', '#FF5722', '#03A9F4'],
                  borderColor: ['#4CAF50', '#FFEB3B', '#FF5722', '#03A9F4'],
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 100
                  }
              }
          }
      });
  
      var audienceHintModal = document.getElementById('audienceHintModal');
      audienceHintModal.style.display = "block";
  
      // Отключаем кнопку "Помощь зала" после использования
      var audienceHintButton = document.querySelector('.u-btn-2');
      audienceHintButton.classList.add('disabled-btn');
      audienceHintButton.onclick = null;
  }
  
  
    document.getElementById('audienceHintOkButton').onclick = function() {
      document.getElementById('audienceHintModal').style.display = "none";
    };
  
    document.getElementById('closeAudienceHintModal').onclick = function() {
      document.getElementById('audienceHintModal').style.display = "none";
    };
  
    window.onclick = function(event) {
      var audienceHintModal = document.getElementById('audienceHintModal');
      if (event.target == audienceHintModal) {
        audienceHintModal.style.display = "none";
      }
    };

    function convertAnswerToLetter(answer) {
      const answerMap = {
          "1": "A",
          "2": "B",
          "3": "C",
          "4": "D"
      };
      return answerMap[answer];
  }
  

  function showFriendHint() {
    var correctAnswer = document.getElementById('questionContainer').getAttribute('data-right-answer');
    var friendHintText = document.getElementById('friendHintText');

    onHint();

    if (correctAnswer) {
        friendHintText.innerHTML = "Ваш друг считает, что правильный ответ " + convertAnswerToLetter(correctAnswer);
    } else {
        friendHintText.innerHTML = "Правильный ответ не найден.";
    }

    var friendHintModal = document.getElementById('friendHintModal');
    friendHintModal.style.display = "block";

    // Отключаем кнопку "Звонок другу" после использования
    var friendHintButton = document.getElementById('friendHintButton');
    friendHintButton.classList.add('disabled-btn');
    friendHintButton.onclick = null; // Отключаем возможность повторного использования
}




  
  document.getElementById('friendHintOkButton').onclick = function() {
    document.getElementById('friendHintModal').style.display = "none";
  };
  
  document.getElementById('closeFriendHintModal').onclick = function() {
    document.getElementById('friendHintModal').style.display = "none";
  };
  
  window.onclick = function(event) {
    var friendHintModal = document.getElementById('friendHintModal');
    if (event.target == friendHintModal) {
      friendHintModal.style.display = "none";
    }
  };
  
    

    var secondChance = false; // Переменная для отслеживания права на ошибку
    var secondChanceUsed = false; // Переменная для отслеживания использования подсказки

    window.onload = function() {
      // Проверяем, есть ли в cookies флаг успешной регистрации
      var registrationSuccess = document.cookie.split('; ').find(row => row.startsWith('registration_success='));
      if (!registrationSuccess) {
          modal.style.display = "block";
      }
      playBackgroundMusic();
      updateLevelHighlight(1); // Выделение начального уровня
  };
  

    function activateSecondChance() {
      secondChanceUsed = true;
      var secondChanceButton = document.getElementById('secondChanceButton');
      secondChanceButton.classList.add('disabled-btn');
      secondChanceButton.onclick = null; // Отключение возможности повторного использования
  }
  

    // Обработчик клика по кнопкам ответа
    document.querySelectorAll('.answer-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            submitAnswer(this.getAttribute('data-answer'), this.dataset.questionId);
        });
    });

    function replaceQuestion() {
      // Определение текущего уровня вопроса или установка по умолчанию
      var currentLevel = parseInt(document.getElementById('questionContainer').getAttribute('data-current-level')) || 1;
  
      onHint();

      // Запрос нового вопроса с уровнем +1 или перезапуск с первого уровня
      updateQuestionAndAnswers(currentLevel + 1);
  
      // Деактивация кнопки замены вопроса
      var replaceQuestionButton = document.querySelector('.u-btn-5');
      replaceQuestionButton.classList.add('disabled-btn');
      replaceQuestionButton.onclick = null; // Удаление события onclick для предотвращения повторного использования
  }
  
  function updateQuestionAndAnswers(level) {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", `/get-question/${level}`, true);
    xhr.onreadystatechange = function() {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
            const response = JSON.parse(this.responseText);

            // Проверка наличия правильного ответа в ответе сервера
            if (response.right_answer) {
                console.log('Right answer from server:', response.right_answer); // Логирование для отладки

                document.getElementById('questionText').innerText = response.question_text;
                var questionContainer = document.getElementById('questionContainer');
                questionContainer.setAttribute('data-current-level', level); // Обновление уровня вопроса
                questionContainer.setAttribute('data-right-answer', response.right_answer); // Обновление правильного ответа

                response.answers.forEach((answer, index) => {
                    const answerButton = document.querySelector(`#answerBtn${index + 1}`);
                    answerButton.innerText = `${String.fromCharCode(65 + index)}: ${answer}`;
                    answerButton.setAttribute('data-answer', index + 1);
                    answerButton.setAttribute('data-question-id', response.question_id);

                    // Сброс состояний кнопок
                    resetButtonState(answerButton);
                });

                updateLevelHighlight(level); // Обновление выделения уровня
                startTimer(); // Перезапуск таймера
                playBackgroundMusic();
            } else {
                console.error('No right answer received from server.');
            }
        } else if (this.readyState === XMLHttpRequest.DONE) {
            console.error('Failed to get new question:', this.statusText);
        }
    };
    xhr.send();
}





function updateLevelHighlight(level) {
    document.querySelectorAll('[id^="level"]').forEach(elem => {
        elem.classList.remove('current-level');
    });
    document.getElementById(`level${level}`).classList.add('current-level');
}

  
  function resetButtonState(button) {
      button.style.opacity = '1';
      button.style.backgroundColor = '';
      button.style.pointerEvents = 'auto';
      button.classList.remove('disabled-btn', 'highlight');
      button.onclick = function(e) {
          e.preventDefault();
          submitAnswer(this.getAttribute('data-answer'), this.dataset.question_id);
      };
  }
  
  
  
  
  function useFiftyFifty() {
    var questionContainer = document.getElementById('questionContainer');
    var correctAnswer = questionContainer.getAttribute('data-right-answer'); // Получаем правильный ответ

    onHint();

    // Остальная логика для обработки подсказки 50/50
    var answers = [document.getElementById('answerBtn1'), document.getElementById('answerBtn2'), document.getElementById('answerBtn3'), document.getElementById('answerBtn4')];
    var incorrectAnswers = answers.filter(btn => btn.getAttribute('data-answer') !== correctAnswer);

    // Перемешиваем и делаем два ответа менее заметными
    shuffleArray(incorrectAnswers);
    incorrectAnswers.slice(0, 2).forEach(function(btn) {
        btn.style.opacity = '0.5'; // Меняем прозрачность
        btn.onclick = null; // Отключаем возможность клика
    });

    // Отключаем кнопку 50/50
    var fiftyFiftyButton = document.getElementById('fiftyFiftyButton');
    fiftyFiftyButton.classList.add('disabled-btn');
    fiftyFiftyButton.onclick = null;
}



// Функция для перемешивания массива (используется для случайного выбора ответов)
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}



    // Функция отправки ответа и обработки результата
    // Функция для запуска 5-секундного отсчёта
function startCountdown(duration, onEnd) {
  var timer = duration, seconds;
  clearInterval(timerInterval); // Очистка текущего интервала таймера
  timerInterval = setInterval(function() {
      seconds = parseInt(timer);
      document.getElementById('timerDisplay').textContent = seconds;
      if (--timer < 1) {
          clearInterval(timerInterval);
          onEnd(); // Вызов функции, которая будет выполнена после окончания отсчёта
      }
  }, 1000);
}

function submitAnswer(answer, questionId) {
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/submit-answer/", true);
  xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
  xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));

  xhr.onreadystatechange = function() {
      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          const response = JSON.parse(this.responseText);
          const correctAnswer = response.correct_answer;

          if (answer === correctAnswer.toString()) {
              // Пользователь ответил правильно
              document.querySelectorAll('.answer-btn').forEach(button => {
                  button.style.backgroundColor = (button.getAttribute('data-answer') === correctAnswer.toString()) ? '#4CAF50' : '#F44336';
              });
              
              onCorrectAnswer();
              // Сброс состояния подсказки "Право на ошибку" при правильном ответе
              secondChanceUsed = false;

              startCountdown(5, function() {
                  updateQuestionAndAnswers(response.next_level);
              });
          } else if (secondChanceUsed && !secondChance) {
              // Пользователь ответил неправильно, но есть право на ошибку
              secondChance = true;
              document.querySelectorAll('.answer-btn').forEach(button => {
                  if (button.getAttribute('data-answer') === answer) {
                      button.classList.add('highlight'); // Подсветка жёлтым цветом
                  }
                  button.classList.remove('disabled-btn');
                  button.style.pointerEvents = 'auto';
              });
          } else {
              // Пользователь использовал право на ошибку и всё равно ответил неправильно
              document.querySelectorAll('.answer-btn').forEach(button => {
                  button.style.backgroundColor = (button.getAttribute('data-answer') === correctAnswer.toString()) ? '#4CAF50' : '#F44336';
              });
              onWrongAnswer();
              displayIncorrectAnswerEffects();
          }
      } else if (this.readyState === XMLHttpRequest.DONE) {
          console.error('Failed to submit answer:', this.statusText);
      }
  };
  xhr.send(`answer=${answer}&question_id=${questionId}`);
}



function disableAllHints() {
  document.querySelectorAll('.u-btn').forEach(button => {
      button.classList.add('disabled-btn');
      button.onclick = null;
  });
}


function displayIncorrectAnswerEffects() {
  clearInterval(timerInterval);
  const display = document.getElementById('timerDisplay');
  var container = display.parentNode.parentNode;
  display.textContent = "Ответ неверный!";
  display.style.paddingLeft = "10px";
  display.style.fontSize = "16px";
  display.style.alignContent = "center";
  container.style.backgroundColor = "#F44336";
  document.querySelectorAll('.answer-btn').forEach(button => {
      button.classList.add('disabled-btn');
  });
  disableAllHints(); // Отключение всех кнопок подсказок
}





    
    // Наблюдатель для запуска таймера при появлении на экране
    document.addEventListener("DOMContentLoaded", function() {
        var timerElement = document.querySelector('.timer');
        var timerStarted = false;
        var observer = new IntersectionObserver(function(entries) {
            if (entries[0].isIntersecting && !timerStarted) {
                timerStarted = true;
                startTimer();
                observer.disconnect(); // Отключение наблюдения после запуска таймера
            }
        }, { threshold: 1.0 });
        observer.observe(timerElement);
    });

        // Функция запуска таймера
        function startTimer() {
    clearInterval(timerInterval);  // Очищаем предыдущий таймер, если он был запущен
    var duration = 60;
    var display = document.getElementById('timerDisplay');
    var container = display.parentNode.parentNode;
    var timer = duration, seconds;
    timerInterval = setInterval(function() {
        seconds = parseInt(timer, 10);
        display.textContent = seconds < 10 ? "0" + seconds : seconds;
        if (seconds > 40) {
            container.style.backgroundColor = "#4CAF50";
        } else if (seconds > 20) {
            container.style.backgroundColor = "#FFEB3B";
        } else {
            container.style.backgroundColor = "#F44336";
        }
        if (--timer < 0) {
            clearInterval(timerInterval);
            display.textContent = "Время вышло!";
            display.style.paddingLeft = "20px"
            display.style.fontSize = "16px";
            container.style.backgroundColor = "#F44336";
            // Делаем кнопки неактивными и прозрачными
            document.querySelectorAll('.answer-btn').forEach(button => {
                button.classList.add('disabled-btn');
            });
        }
    }, 1000);
}

  </script>
    


  

    
    <footer class="u-clearfix u-footer u-grey-80" id="sec-4eee"><div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <p class="u-text u-text-default u-text-1">Who wants to be a millionare</p>
      </div></footer>
  
</body></html>